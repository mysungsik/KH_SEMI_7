let reportData = [
	{no : 1 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕 했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 2 , id : "test_id1", rep_type : "게시글",  vio_type: "허위사실", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 3 , id : "test_id1", rep_type : "뉴스",  vio_type: "허위사실", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 4 , id : "test_id1", rep_type : "댓글",  vio_type: "사행성조장", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 5 , id : "test_id1", rep_type : "댓글",  vio_type: "혐오발언", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 6 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 7 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 8 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 9 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 10 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 11 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 12 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 13 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 14 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 15 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 16 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 17 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 18 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 19 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 20 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 21 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 22 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 23 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 24 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 25 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 26 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 27 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 28 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 29 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 30 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 31 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 32 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 33 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 34 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 35 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 36 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
	{no : 37 , id : "test_id1", rep_type : "댓글",  vio_type: "욕설", rep_content:"심한 인신공격, 나쁜 욕했습니다. 처벌좀여", board_title:"손흥민 월클 맞습니다.", content : "게시글 내용입니다 ... 으로 한줄 작성합니다."},
]

$(document).ready(function () {
	// 페이지네이션 실행
	const request_url = `${contextPath}/api/admin/profile/getAllUsersData`;
	
	$.ajax({
		type: "GET",
		url: request_url,
		dataType: "json",
		success: function (res) {
			let isGetData = res.hasOwnProperty("data")
			if (isGetData){
				const userData = res.data;
				paginationActive("user", userData, adminTemplate);
			}
        },
		error : function(request, status, error){
			console.log(request);
			console.log(status);
			console.log(error);
		}
	});
	
	paginationActive("report", reportData, adminTemplate);

});


// 관리자용 페이지네이션 템플릿 함수 (User)
function adminTemplate(data, id) {
	let item = ""
	if (id == "user"){
		item += `
			<table class="manage-table">
				<thead>
					<tr> 
						<td>No</td> 
						<td>아이디</td> 
						<td>Email</td> 
						<td>Role</td> 
						<td>Number</td> 
						<td>상세</td> 
					</tr>
				</thead>
				<tbody>`
		$.each(data, function(index, d){
	  	item += 
	  		`<tr>
				<input type="hidden" class="userAddress" value='${d.userAddress}'> 
				<input type="hidden" class="userState" value='${d.userState}'> 
				<input type="hidden" class="lastLogin" value='${d.lastLogin}'> 
				<input type="hidden" class="deletedDate" value='${d.deletedDate}'> 
				<td class="userNo">${d.userNo}</td> 
				<td class="userId" disabled>${d.userId}</td> 
				<td class="userEmail">${d.userEmail}</td> 
				<td class="userAuthority">${d.userAuthority}</td> 
				<td class="userPhone">${d.userPhone}</td> 
				<td data-num=${d.userNo}><img class="edit" src="/SPORTS_PROJECT/public/icons/edit.png"></td> 
			</tr>`
		})
		item += `</tbody>
	             </table>`
	} 
	// 관리자용 페이지네이션 템플릿 함수 (Report)
	else {
		item += `
			<table class="manage-table">
				<thead>
					<tr> 
						<td>No</td> 
						<td>아이디</td> 
						<td>신고 유형</td> 
						<td>위반 유형</td> 
						<td>신고 내용</td> 
						<td>상세</td> 
					</tr>
				</thead>
				<tbody>
				`;
		$.each(data, function(index, d){
	  	item += 
	  		`<tr> 
				<input type="hidden" class="board_title" value='${d.board_title}'> 
				<input type="hidden" class="content" value='${d.content}'> 
				<td class="no" >${d.no}</td> 
				<td class="id" >${d.id}</td> 
				<td class="rep_type" >${d.rep_type}</td> 
				<td class="vio_type" >${d.vio_type}</td> 
				<td class="rep_content" >${d.rep_content}</td> 
				<td data-num=${d.no}><img class="edit" src="/SPORTS_PROJECT/public/icons/edit.png"></td> 
			</tr>`
		})
		item += `</tbody>
	             </table>`
	}

    return item;
}

// 페이지네이션 실행 함수
function paginationActive(id, datas, template){
	
	// 한 페이지당 개수 정하기
	let page_size = 20;
	
	// 각 조건에 맞게 페이지네이션 실행
	if ( $(`#${id}-pagination`).length > 0 ){

		 $(`#${id}-pagination`).pagination({
		    dataSource: datas,
		    pageSize: page_size,
		    callback: function(data, pagination) {
		        let html = template(data,id);
		        $(`#${id}-data`).html(html);	// 데이터 페이지네이션
				let currentPage = pagination.pageNumber;	// 현재 페이지 번호
				// 페이지네이션 변경
				let pagingEl = $(`.paginationjs-page[data-num='${currentPage}'] a`);
				pagingEl.css({
					fontSize : "14px",
					textDecoration : "underline"
				})
			}
		})
		
		// 조건에 맞는 edit 수행
		if (id == "user"){
			$(".edit").on("click", function(){
				let data = {
					userNo : $(this).parent().parent().find(".userNo").text(),
					userId : $(this).parent().parent().find(".userId").text(),
					userEmail : $(this).parent().parent().find(".userEmail").text(),
					userAuthority : $(this).parent().parent().find(".userAuthority").text(),
					userPhone : $(this).parent().parent().find(".userPhone").text(),
					userAddress : $(this).parent().parent().find(".userAddress").val(),
					userState : $(this).parent().parent().find(".userState").val(),
					lastLogin : $(this).parent().parent().find(".lastLogin").val(),
					deletedDate : $(this).parent().parent().find(".deletedDate").val()
				}
				
				showModal(id, data, $(this))
				
			})
				
		} else if (id == "report"){
			$(".edit").on("click", function(){
				let data = {
					no : $(this).parent().parent().find(".no").text(),
					id : $(this).parent().parent().find(".id").text(),
					rep_type : $(this).parent().parent().find(".rep_type").text(),
					vio_type : $(this).parent().parent().find(".vio_type").text(),
					rep_content : $(this).parent().parent().find(".rep_content").text(),
					board_title : $(this).parent().parent().find(".board_title").val(),
					content : $(this).parent().parent().find(".content").val()
				}

				showModal(id, data, $(this))
			})
		}
	}
}
	
	

function showModal(id, data ,el){
	let modalEl = $('#adminModal');
	
	if (id == "user"){
		modalEl.find(".modal-title").html(`<p class="fs-14 fc__white">회원관리 / 회원번호 : <span class="userNo">${data.userNo}</span></p>`)
				
		modalEl.find(".modal-body").html(`
			<div class="modal-row">
				<div>
					<label for="user_id"> USER ID </label>
					<input type="text" id="user_id" name="user_id" value="${data.userId}" disabled>				
				</div>
				<div>
					<label for="user_email"> USER EMAIL </label>
					<input type="text" id="user_email" name="user_email" value="${data.userEmail}" disabled>								
				</div>
			</div>
			<div  class="modal-row">
				<div>
					<label for="user_id"> USER ROLE </label>
					<input type="text" id="user_id" name="user_auth" value="${data.userAuthority}">				
				</div>
				<div>
					<label for="user_email"> USER ADDRESS </label>
					<input type="text" id="user_email" name="user_address" value="${data.userAddress}" disabled>								
				</div>
			</div>
			<div  class="modal-row">
				<div>
					<label for="user_id"> USER NUMBER </label>
					<input type="text" id="user_id" name="user_phone" value="${data.userPhone}" disabled>				
				</div>
				<div>
					<label for="user_lastLogin"> LAST LOGIN </label>
					<input type="text" id="user_lastLogin" name="user_lastLogin" value="${data.lastLogin}" disabled>								
				</div>
			</div>
			<div  class="modal-row">
				<div>
					<label for="user_id"> USER STATEMENT </label>
					<input type="text" id="user_id" name="user_state" value="${data.userState}">				
				</div>
				<div>
					<label for="user_deletedDt"> DELETED DATE </label>
					<input type="text" id="user_deletedDt" name="user_deletedDt" value="${data.deletedDate}" disabled>								
				</div>
			</div>
			
			<div class="modal-btns">
				<button class="btn-medium__blue modifyBtn"> 수정 </button>
				<button class="btn-medium__gray cancelBtn" data-bs-dismiss="modal"> 취소 </button>
				<button class="btn-medium__red deleteBtn"> 삭제</button>
			</div>
			`
		);
	} else if (id == "report"){
	
		modalEl.find(".modal-title").html(`<p class="fs-14 fc__white">신고관리 / 신고번호 : <span class="reportNo">${data.no}</span></p>`)
		
		modalEl.find(".modal-body").html(`
			<div class="modal-row">
				<div>
					<label for="user_id"> USER ID </label>
					<input type="text" id="user_id" name="user_id" value="${data.id}">				
				</div>
				<div>
					<label for="user_email"> 신고 유형 </label>
					<input type="text" id="user_email" name="user_email" value="${data.rep_type}">								
				</div>
			</div>
			<div  class="modal-row">
				<div>
					<label for="user_id"> 위반 유형 </label>
					<input type="text" id="user_id" name="user_id" value="${data.vio_type}">				
				</div>
				<div>
					<label for="user_email"> 신고 내용 </label>
					<input type="text" id="user_email" name="user_email" value="${data.rep_content}">								
				</div>
			</div>
			<div  class="modal-row">
				<div>
					<label for="board_title"> 게시글 제목 </label>
					<input type="text" id="board_title" name="board_title" value="${data.board_title}">				
				</div>
			</div>
			<div class="modal-row">
				<div>
					<label for="content"> 게시글 내용 </label>
					<input type="text" id="content" name="content" value="${data.content}">				
				</div>
			</div>
			<a class="move-board fs-10 fc__blue text-hover__blue"> 해당 게시글로 이동 </a> 
			
			
			<div class="modal-btns">
				<button class="btn-medium__blue reportAcceptBtn"> 신고 처리 </button>
				<button class="btn-medium__gray cancelBtn" data-bs-dismiss="modal"> 취소 </button>
				<button class="btn-medium__red reportCancelBtn"> 신고 취소 </button>
			</div>
			`
		);
	}

	// modifyBtn 에 수정 이벤트 추가 && 부모의 Element 전달 (데이터 변경용)
	modalEl.find(".modifyBtn").on("click", function() {
		updateUserInfo(el);
	});

	// deleteBtn 에 삭제 이벤트 추가
	modalEl.find(".deleteBtn").on("click", function() {
		deleteUser(el);
	});
	
	modalEl.modal('show');
}

// 유저 수정
function updateUserInfo(el){
	let modalEl = $('#adminModal');
	let adminModal = bootstrap.Modal.getInstance(modalEl);

	const userNo = $(".modal-title .userNo").text();
	let userAuthority = $(".modal-body input[name='user_auth']").val().toUpperCase();
	let userState = $(".modal-body input[name='user_state']").val().toUpperCase();

	if (authValidate(userAuthority) && stateValidate(userState)){
		const request_url = `${contextPath}/api/admin/profile/updateUserInfo`
		const data = {
			userNo,
			userAuthority,
			userState
		}
	
		$.ajax({
			type: "POST",
			url: request_url,
			data : data,
			dataType: "json",
			async : false,
			success: function (res) {
				let isUpdated = res.hasOwnProperty("data")
				if (isUpdated){
					el.parent().parent().find(".userAuthority").text(userAuthority)
					el.parent().parent().find(".userState").text(userState)
					toastPop("info", res.message)
				} else{
					toastPop("warn", res.message)
				}
			},
			error : function(request, status, error){
				toastPop("warn", "권한 변경에 실패하였습니다.")
				console.log(request);
				console.log(status);
				console.log(error);
			}
		});

		adminModal.hide();
	}
}

// 유저 삭제일 업데이트
function deleteUser(el){
	let modalEl = $('#adminModal');
	let adminModal = bootstrap.Modal.getInstance(modalEl);

	const userNo = $(".modal-title .userNo").text();
	
	const request_url = `${contextPath}/api/admin/profile/deleteUser`
	const data = {
		userNo
	}

	$.ajax({
		type: "POST",
		url: request_url,
		data : data,
		dataType: "json",
		async : false,
		success: function (res) {
			let isDeleted = res.hasOwnProperty("data")
			if (isDeleted){
				el.parent().parent().find(".deletedDate").val(res.data)
				toastPop("info", res.message)
			} else{
				toastPop("warn", res.message)
			}
		},
		error : function(request, status, error){
			toastPop("warn", "유저 삭제에에 실패하였습니다.")
			console.log(request);
			console.log(status);
			console.log(error);
		}
	});

	adminModal.hide();

}